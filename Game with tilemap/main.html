<!doctype html> 
<html lang="en"> 
<head> 
    <link rel="stylesheet" href="style.css">
    <meta charset="UTF-8" />
    <title>TileMap</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.js"></script>

</head>
<body>

<script type="text/javascript"> 

    var config = {
        type: Phaser.AUTO,
        width: 550,
        height: 350,
        physics: {
            default: 'arcade',
            arcade: {
                gravity: { y: 0 },
                debug: false
            }
        },
        scene: {
            preload: preload,
            create: create,
            update: update
        }
    };

    var items;
    var basketHere = true;
    var test;
    var player;
    var disc;
    var sign;
 
    var cursors;
    let keyA;
    let keyS;
    let keyD;
    let keyW;
    let keyE;
    let keyF;

    var collectDia;
    var dialogBox;
    var dialogOne;
    var dialogTwo;
    
    var over = false;
    var overE = false;
    //                        0              1
    var currentDia = ['Hello hello hello', '...'];
    var group;
    var testingDia;

    var game = new Phaser.Game(config);

    function preload ()
    {
        this.load.image("tiles", "src/tilemap/tilesheet_basic.png");
        this.load.tilemapTiledJSON("map", "src/tilemap/map1.json");
        this.load.image("player", "src/assets/arrow.png");
        this.load.image("testing", "src/assets/cloud.png");
        this.load.image("basket", "src/assets/basket.png");
        this.load.image("blaze", "src/assets/aww.png");
        this.load.image("person", "src/assets/CreeperSnail.png");
        this.load.image("lofi", "src/assets/dvd1.png");
        this.load.image("mydvd", "src/assets/dvd2.png");

        this.load.image("sign", "src/assets/sign.png");
        this.load.image("jar", "src/assets/jar.png");
        this.load.image("mancome", "src/assets/mancome.png");

        this.load.image("bg", "src/assets/scaled.png");
    }


    function create ()
    {
        var bg = this.add.image(275, 175, 'bg').setScrollFactor(0);

        const map = this.make.tilemap({ key: "map", tileWidth: 32, tileHeight: 32});
        const tileset = map.addTilesetImage("tiles1", "tiles");
        const groundLayer = map.createLayer("ground", tileset, 0, 0); //bottomest layer goes first?
        const topLayer = map.createLayer("HillsWater", tileset, 0, 0);
        topLayer.setCollisionByExclusion(-1); //actually makes collisions work???
        
        

        player = this.physics.add.sprite(100, 300, 'player').setScale(0.5);
        this.physics.add.collider(player, topLayer);
        this.cameras.main.startFollow(player, true); //the start of it all
        

        test = this.physics.add.sprite(100, 250, 'testing').setScale(0.6);
        test.setCollideWorldBounds(true);
        test.setScrollFactor(0, 0);

        items = this.physics.add.staticGroup();
        items.create(850, 400, 'basket');
        items.create(400, 250, 'person');

        disc = this.physics.add.sprite(50, 10, 'lofi').setSize(100, 70).setOffset(-20, 20);

        discTwo = this.physics.add.sprite(120, 500, 'mydvd').setSize(100, 70).setOffset(-20, 20);

        sign = this.physics.add.sprite(840, 470, 'sign').setSize(280, 120).setOffset(40, 80);


        var roadName = this.add.text(320, 275, 'baguette road',
        { fontSize: '32px', fill: '#fcf9fc'});
        

        /*this.DialogBox = this.add.graphics();
        this.DialogBox.fillStyle(0x3d2f25, 1); // put 0x in front for # i guess
        this.DialogBox.fillRoundedRect(100, 230, 300, 100, 2);
        this.DialogBox.setScrollFactor(0);*/


        dialogBox = this.add.rectangle(130, 245, 300, 100, 0x3d2f25).setVisible(false);
        dialogBox.setScrollFactor(0).setOrigin(0,0);

        collectDia = this.add.rectangle(player.body.position.x + 230, player.body.position.y - 160,
         120, 50, 0xc1a168).setVisible(true);
        collectDia.setScrollFactor(0).setOrigin(0,0);

        Ecollect = this.add.text(collectDia.x + 5, collectDia.y + 5, 'F to collect \n water',
        { fontSize: '24px', fill: 'white', fontStyle: 'strong'});
        Ecollect.setScrollFactor(0).setOrigin(0,0).setVisible(true);
        /*this.physics.add.overlap(sign, player, function(){
            overE = true;
            Ecollect.setVisible(true);
            collectWater();
        });*/

        this.physics.add.overlap(player, sign, collectWater, null, this);

        //_____most/some dialogs idk
        dialogOne = this.add.text(dialogBox.x + 5, dialogBox.y + 5, currentDia[0],
        { fontSize: '24px', fill: '#fcf9fc'});
        dialogOne.setScrollFactor(0).setOrigin(0,0).setVisible(false);
        this.physics.add.overlap(disc, player, function(){
            over = true;
            dialogOne.setVisible(true);
            
        });

        this.physics.add.overlap(discTwo, player, function(){
            over = true;
            dialogTwo.setVisible(true);
            
        });



        dialogTwo = this.add.text(dialogBox.x + 5, dialogBox.y + 5, currentDia[1],
        { fontSize: '24px', fill: '#fcf9fc'});
        dialogTwo.setScrollFactor(0).setOrigin(0,0).setVisible(false);

        group = this.add.group();
        testingDia = group.add(this.add.text(130, 245, 'hello').setVisible(true));
        testingDio = group.add(this.add.text(130, 280, 'goodbye').setVisible(true));



        keyA = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.A);
        keyS = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.S);
        keyD = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.D);
        keyW = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.W);
        keyE = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.E);
        keyF = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.F);

        cursors = this.input.keyboard.createCursorKeys(); //collides go under

        this.physics.add.overlap(player, items, speak, null, this);
        
    }
    
    function update (){
        
        player.setVelocity(0);

        if(keyA.isDown) {
            player.setVelocityX(-190);
            player.angle = -90;
            
        } else if(keyS.isDown) {
            player.setVelocityY(190);
            player.angle = 180;
            
        } else if(keyD.isDown) {
            player.setVelocityX(190);
            player.angle = 90;
        } else if(keyW.isDown) {
            player.setVelocityY(-190);
            //player.flipY = false;
            player.angle = 0;
            
        } else{
            player.setVelocity(0);
            
        }

        

        /*var touching = !player.body.touching.none;
        if (touching){ //works?
            console.log("touching le disc");
        }*/
       
        if (over){
            over = false;
            console.log('touched once');
            dialogBox.setVisible(true);
        } else{
            //console.log('not NOTUCHJIGN');
            dialogBox.setVisible(false);
            dialogOne.setVisible(false);
            dialogTwo.setVisible(false);
        }

        if (overE){
            overE = false;
            collectDia.setVisible(true);
        } else{
            collectDia.setVisible(false);
            Ecollect.setVisible(false);
        }
        
        if (keyD.isDown){
            testingDia.setVisible(true);
            testingDio.setVisible(true);
        }
        if (keyE.isDown){
            
            //group.clear(true, true);
            console.log(layer);
        }
        //SetVisible(group.getChildren(), value)


        

    }         //END UP UPDATE FUNCT 
    var layer = this.add.layer(group);

    var uhh = false;

    function collectWater(){
        overE = true;
        Ecollect.setVisible(true);
        
        if (keyF.isDown){
            if (uhh == false){
                uhh = true;
                var jar = this.physics.add.sprite(player.body.position.x - 5, player.body.position.y + 15, 'jar')
                .setScale(0.4).setSize(90, 90);
                console.log('only collect one?');
            }
        }

        if (keyF.isUp){
            uhh = false;
        }
        this.physics.add.overlap(player, jar, colJ, null, this);
    }

    function colJ(){
        if (keyF.isDown){
            console.log(player);
        }
    }

    function speak (player, items){
        console.log("hey ya");
    }


    /*
const debugGraphics = this.add.graphics().setAlpha(0.7);
topLayer.renderDebug(debugGraphics, {
    tileColor: null,
    collidingTileColor: new Phaser.Display.Color(243, 234, 48, 255),
    faceColor: new Phaser.Display.Color(40, 39, 37, 255)
});
*/

</script>

</body>
</html>

